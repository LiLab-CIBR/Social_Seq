# 服务器环境配置
**目前软件存在兼容性问题，建议使用早一点的版本**。

服务器硬件配置包括：Intel Xeon 4314 CPU、256 GB 内存、4 块 NVIDIA GeForce RTX 3090 GPU 显卡、1 TB 固态硬盘和 8 TB 机械硬盘。

软件环境包括 Ubuntu 18.04 操作系统，CUDA 11.4、cuDNN 8.8 和TensorRT 8.6 深度学习框架，以及 Python 3.7.16、OpenCV-Python 4.8.0、TensorFlow 2.7.0和 PyTorch 1.11.0 等开发工具，用于深度学习模型训练和数据分析。

!!! warning "重要警告"
    目前仅支持 Ubuntu 系统和NVIDIA显卡，其他系统请自行查阅相关资料。

!!! warning "重要警告"
    由于软件是在2019年配置的，因此部分软件版本可能已经过时，建议根据实际需求选择最新版本。同时，建议使用最新版本的 CUDA、cuDNN 和 TensorRT 等深度学习框架，以获得更好的性能和兼容性。大部分python库可以在 pip 和 conda 中找到，但是部分库可能难以兼容安装。本文档不再对兼容性进行详细说明，请自行查阅相关资料。


## 强烈建议安装软件列表

| 软件名称 | 本机测试版本号（2022年） | 2025年版本，未测试 | 备注 |
| :----: | :----: | :----: | :----: |
| Ubuntu | 18.04 | 24.04 | 操作系统，推荐 |
| Python | 3.7.16 | 3.12 | 开发语言，必须 |
| CUDA | 11.4 | 12.9 | 深度学习框架，必须 |
| cuDNN | 8.8 | 8.9 | 深度学习框架，必须 |
| TensorRT | 8.6 | 10.13 | 推理加速，必须 |
| OpenCV-Python | 4.8.0 | 4.12.0 | 图像处理，必须 |
| TensorFlow | 2.7.0 | 2.16.0 | DANNCE 模型，必须 |
| PyTorch | 1.11.0 | 2.7.1 | 深度学习框架，必须 |
| Docker | 24.0.6 | 28.3.0 | 容器化，用于Mediamtx |
| FFmpeg | 4.x | 6.x | 视频读写 |
| Mediamtx | - | - | 视频流服务器，用于闭环行为干预 |

## 测试安装成功：
所有软件安装完成后，需要进行测试，以确保安装成功。测试方法如下：

测试 nvidia cuda driver
```shell
$ nvidia-smi
```

测试 Nvidia Cuda Compliler
```shell
$ nvcc --version
```

测试 TensorRT命令行工具
```shell
$ trtexec --onnx=/path/to/model.onnx --saveEngine=/path/to/model.engine
```

测试 polygraphy (NVIDIA官方工具) 命令行工具
```shell
$ polygraphy inspect model --onnx=/path/to/model.onnx
```


测试 FFmpeg 命令行工具
```shell
# ffmpeg generate a 640x480 video, 30 fps, 1 minute
$ ffmpeg -f lavfi -i testsrc=duration=60:size=640x480:rate=30 -c:v libx264 -pix_fmt yuv420p -f mp4 /path/to/test.mp4

# convert it to hevc by NVIDIA HEVC encoder
$ ffmpeg -i /path/to/test.mp4 -c:v hevc_nvenc -pix_fmt yuv420p -f mp4 /path/to/test_hevc.mp4
```

测试 Docker 命令行工具
```shell
$ docker run hello-world
$ docker run --rm -it -e MTX_PROTOCOLS=tcp -p 8554:8554 -p 1935:1935 bluenviron/mediamtx
```

## 其它三方工具：
### 1. OPEN-MMLAB/MMDETECTION
这是一个提供了 MaskRCNN 的开源项目，用于目标检测和分割。我们进行了fork (2022年），并添加了自定义的模型和配置文件，以实现多大鼠分割。

安装方法请参考 MMdetection 的[官方文档](https://mmdetection.readthedocs.io/en/latest/get_started.html)。

- 代码地址，https://github.com/chenxinfeng4/mmdetection.git

!!! warning "重要警告"
    我们fork的是 MMDET 1.x 版本，目前支持python3.7；官网最新的MMDET 是 3.x 版本，可能存在严重的兼容性问题。请根据实际需求选择合适的版本。

### 2. OPEN-MMLAB/MMPOSE
这是一个提供了 MaskRCNN 的开源项目，用于人体姿态关键点检测。我们进行了fork（2022年），并添加了自定义的模型和配置文件，以实现小球检测。

安装方法请参考 MMpose 的[官方文档](https://mmpose.readthedocs.io/en/latest/installation.html)。

- 代码地址，https://github.com/chenxinfeng4/mmpose.git

!!! warning "重要警告"
    我们fork的是 MMPOSE 0.x 版本。新版本和环境可能存在兼容性问题。请根据实际需求选择合适的版本。

### 3. YOLO-v8
这是一个轻量级目标检测，实例分割的开源项目。我们进行了fork（2024年），并添加了自定义的模型和配置文件，以实现实时多大鼠分割。

- 代码地址，https://github.com/chenxinfeng4/ultralytics.git

!!! warning "重要警告"
    我们fork的版本，与最新版本可能存在兼容性问题。请根据实际需求选择合适的版本。

### 4. DANNCE
这是一个多视角动物姿态估计的库。我们进行了fork（2022年），并添加了自定义的模型和配置文件，以实现实时多大鼠3D关键点识别。

- 代码地址，https://github.com/chenxinfeng4/dannce.git

!!! warning "重要警告"
    我们fork的版本，与最新版本可能存在兼容性问题。而且，该库的预测精度高，但速度慢。我们进行了速度优化，导致与原始代码存在一些差异，以及更多的兼容性问题。安装起来比较麻烦，我们正在优化安装文档。

### 5. SmoothNet
这是一个姿态时间平滑的库。我们进行了fork（2022年），并添加了自定义的模型和配置文件，以实现实时多大鼠3D关键点平滑。

- 代码地址，https://github.com/chenxinfeng4/SmoothNet.git

!!! warning "重要警告"
    我们fork的版本，与最新版本可能存在兼容性问题。请根据实际需求选择合适的版本。
